<% layout("layouts/boilerplate") -%>
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <h2 class="text-center mb-4">Edit Profile</h2>

    <% if (locals.error && error.length) { %>
      <div class="alert alert-danger" role="alert">
        <%= error %>
      </div>
    <% } %>

    <% if (locals.success && success.length) { %>
      <div class="alert alert-success" role="alert">
        <%= success %>
      </div>
    <% } %>

    <form action="/users/edit" method="POST" novalidate>
      <input type="hidden" name="_method" value="PUT">

      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="name" class="form-label">Name</label>
          <input type="text" class="form-control" id="name" name="name" value="<%= user.name %>" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="email" class="form-label">Gmail Address</label>
          <input type="email" class="form-control" id="email" name="email" value="<%= user.email %>" required>
          <div class="form-text">Only Gmail addresses are accepted.</div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="mobile" class="form-label">Mobile Number</label>
          <input type="tel" class="form-control" id="mobile" name="mobile" value="<%= user.mobile || '' %>">
        </div>
        <div class="col-md-6 mb-3">
          <label for="dateOfBirth" class="form-label">Date of Birth</label>
          <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth" value="<%= user.dateOfBirth ? user.dateOfBirth.toISOString().split('T')[0] : '' %>">
        </div>
      </div>

      <div class="mb-3">
        <label for="address" class="form-label">Address</label>
        <textarea class="form-control" id="address" name="address" rows="3"><%= user.address || '' %></textarea>
      </div>

      <hr class="my-4">
      <h5>Change Password (Optional)</h5>

      <div class="mb-3">
        <label for="currentPassword" class="form-label">Current Password</label>
        <input type="password" class="form-control" id="currentPassword" name="currentPassword">
        <div class="form-text">Required only if changing password.</div>
      </div>

      <div class="mb-3">
        <label for="newPassword" class="form-label">New Password</label>
        <input type="password" class="form-control" id="newPassword" name="newPassword">
      </div>

      <div class="mb-3">
        <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
        <input type="password" class="form-control" id="confirmNewPassword" name="confirmNewPassword">
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Update Profile</button>
        <a href="/listings" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>

<script>
// Client-side validation for password confirmation
document.querySelector('form').addEventListener('submit', function(e) {
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmNewPassword').value;

  if (newPassword && newPassword !== confirmPassword) {
    e.preventDefault();
    alert('New passwords do not match!');
    return false;
  }
});
</script>
