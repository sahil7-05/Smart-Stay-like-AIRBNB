<% layout("layouts/boilerplate") -%>
<link rel="stylesheet" href="/css/search-form-compact.css">
<div class="row">
  <div class="col-12">
    <!-- Premium Listings Hero Section -->
    <section class="listings-hero-section">
      <div class="listings-hero-content">
        <div class="listings-icon-wrapper">
          <i class="fas fa-home listings-hero-icon"></i>
        </div>
        <h1 class="listings-title">All Listings</h1>
        <p class="listings-subtitle">Discover your perfect stay from our curated collection of premium properties</p>
        <div class="listings-decorative-line"></div>
      </div>
    </section>
    
    <!-- Luxury Glassmorphic Search Form -->
    <div class="search-form-glass">
      <div class="search-form-header">
        <div class="search-icon-animated">
          <i class="fas fa-search"></i>
        </div>
        <h3 class="search-title">Find Your Perfect Stay</h3>
        <p class="search-subtitle">Discover amazing places to stay, work, or explore</p>
      </div>

      <form action="/listings" method="GET" class="search-form-content">
        <div class="search-inputs-grid">
          <!-- Primary Search Row -->
          <div class="search-input-group">
            <div class="input-floating-wrapper">
              <input type="text" class="search-input-floating" name="q" id="search-q" value="<%= filters.q || '' %>">
              <label class="floating-label" for="search-q">
                <i class="fas fa-home"></i> Where are you going?
              </label>
            </div>
          </div>

          <div class="search-input-group">
            <div class="input-floating-wrapper">
              <input type="text" class="search-input-floating" name="location" id="search-location" value="<%= filters.location || '' %>">
              <label class="floating-label" for="search-location">
                <i class="fas fa-map-marker-alt"></i> Location
              </label>
            </div>
          </div>

          <div class="search-input-group">
            <div class="dropdown-animated">
              <select class="search-select-floating" name="type" id="search-type">
                <option value="">All Types</option>
                <option value="stay" <%= filters.type === 'stay' ? 'selected' : '' %>>ğŸ  Stay</option>
                <option value="experience" <%= filters.type === 'experience' ? 'selected' : '' %>>ğŸ­ Experience</option>
                <option value="restaurant" <%= filters.type === 'restaurant' ? 'selected' : '' %>>ğŸ½ï¸ Restaurant</option>
              </select>
              <label class="dropdown-label" for="search-type">
                <i class="fas fa-tag"></i> Property Type
              </label>
              <i class="fas fa-chevron-down dropdown-arrow"></i>
            </div>
          </div>

          <!-- Price Range -->
          <div class="search-input-group price-group">
            <div class="price-inputs-floating">
              <div class="input-floating-wrapper">
                <input type="number" class="search-input-floating price-input" name="minPrice" id="search-minPrice" placeholder="Min" value="<%= filters.minPrice || '' %>">
                <label class="floating-label" for="search-minPrice">Min Price</label>
              </div>
              <span class="price-separator">
                <i class="fas fa-minus"></i>
              </span>
              <div class="input-floating-wrapper">
                <input type="number" class="search-input-floating price-input" name="maxPrice" id="search-maxPrice" placeholder="Max" value="<%= filters.maxPrice || '' %>">
                <label class="floating-label" for="search-maxPrice">Max Price</label>
              </div>
            </div>
            <label class="price-range-label">
              <i class="fas fa-dollar-sign"></i> Price Range
            </label>
          </div>
        </div>
      
        <!-- Advanced Filters -->
        <div class="advanced-filters-section">
          <div class="advanced-filters-grid">
            <div class="filter-group">
              <div class="dropdown-animated">
                <select class="search-select-floating" name="purpose" id="search-purpose">
                  <option value="all">All Purposes</option>
                  <option value="parking" <%= filters.purpose === 'parking' ? 'selected' : '' %>>ğŸ…¿ï¸ Parking</option>
                  <option value="night-stay" <%= filters.purpose === 'night-stay' ? 'selected' : '' %>>ğŸŒ™ Night Stay</option>
                  <option value="permanent-rental" <%= filters.purpose === 'permanent-rental' ? 'selected' : '' %>>ğŸ  Permanent Rental</option>
                  <option value="godowns" <%= filters.purpose === 'godowns' ? 'selected' : '' %>>ğŸ­ Godowns</option>
                  <option value="tuition-coaching" <%= filters.purpose === 'tuition-coaching' ? 'selected' : '' %>>ğŸ“š Tuition/Coaching</option>
                  <option value="shops-commercial" <%= filters.purpose === 'shops-commercial' ? 'selected' : '' %>>ğŸª Shops/Commercial</option>
                  <option value="co-working" <%= filters.purpose === 'co-working' ? 'selected' : '' %>>ğŸ’¼ Co-working</option>
                  <option value="general" <%= filters.purpose === 'general' ? 'selected' : '' %>>ğŸ”§ General</option>
                </select>
                <label class="dropdown-label" for="search-purpose">
                  <i class="fas fa-building"></i> Purpose
                </label>
                <i class="fas fa-chevron-down dropdown-arrow"></i>
              </div>
            </div>

            <div class="filter-group">
              <div class="dropdown-animated">
                <select class="search-select-floating" name="category" id="search-category">
                  <option value="all">All Categories</option>
                  <option value="apartment" <%= filters.category === 'apartment' ? 'selected' : '' %>>ğŸ¢ Apartment</option>
                  <option value="house" <%= filters.category === 'house' ? 'selected' : '' %>>ğŸ  House</option>
                  <option value="villa" <%= filters.category === 'villa' ? 'selected' : '' %>>ğŸ° Villa</option>
                  <option value="condo" <%= filters.category === 'condo' ? 'selected' : '' %>>ğŸ™ï¸ Condo</option>
                  <option value="studio" <%= filters.category === 'studio' ? 'selected' : '' %>>ğŸ¨ Studio</option>
                  <option value="room" <%= filters.category === 'room' ? 'selected' : '' %>>ğŸ›ï¸ Room</option>
                  <option value="office" <%= filters.category === 'office' ? 'selected' : '' %>>ğŸ¢ Office</option>
                  <option value="shop" <%= filters.category === 'shop' ? 'selected' : '' %>>ğŸª Shop</option>
                  <option value="warehouse" <%= filters.category === 'warehouse' ? 'selected' : '' %>>ğŸ­ Warehouse</option>
                  <option value="other" <%= filters.category === 'other' ? 'selected' : '' %>>ğŸ”§ Other</option>
                </select>
                <label class="dropdown-label" for="search-category">
                  <i class="fas fa-tags"></i> Category
                </label>
                <i class="fas fa-chevron-down dropdown-arrow"></i>
              </div>
            </div>

            <div class="filter-group">
              <div class="input-floating-wrapper">
                <input type="date" class="search-input-floating" name="startDate" id="search-startDate" value="<%= filters.startDate || '' %>">
                <label class="floating-label" for="search-startDate">
                  <i class="fas fa-calendar-alt"></i> Start Date
                </label>
              </div>
            </div>

            <div class="filter-group">
              <div class="input-floating-wrapper">
                <input type="date" class="search-input-floating" name="endDate" id="search-endDate" value="<%= filters.endDate || '' %>">
                <label class="floating-label" for="search-endDate">
                  <i class="fas fa-calendar-check"></i> End Date
                </label>
              </div>
            </div>
          </div>
        </div>
      

      
      <div class="search-actions">
        <button type="submit" class="search-btn-primary">
          <i>ğŸ”</i> Search Properties
        </button>
        <a href="/listings" class="search-btn-secondary">
          <i>ğŸ—‘ï¸</i> Clear All Filters
        </a>
      </div>
    </form>
  </div>
</div>

<div class="row">
  <% for (let listing of allListings) { %>
    <div class="col-lg-4 col-md-6 mb-4">
      <div class="card listing-card">
        <img src="<%= listing.image.url %>" class="card-img-top listing-image" alt="<%= listing.title %>">
        <div class="card-body">
          <h5 class="card-title"><%= listing.title %></h5>
          <p class="card-text"><%= listing.description.substring(0, 100) %>...</p>
          <p class="card-text"><strong>Location:</strong> <%= listing.location %>, <%= listing.country %></p>
          <p class="card-text"><strong>Type:</strong> <%= listing.type %></p>
          <p class="card-text"><strong>Purpose:</strong> <%= listing.purpose %></p>
          <p class="card-text"><strong>Category:</strong> <%= listing.category %></p>
          <p class="card-text price-tag">$<%= listing.price %>/night</p>
          <a href="/listings/<%= listing._id %>" class="btn btn-primary">View Details</a>
        </div>
      </div>
    </div>
  <% } %>
</div>

<% if (!allListings || allListings.length === 0) { %>
  <div class="row">
    <div class="col-12 text-center">
      <h3>No listings found</h3>
      <p>Try adjusting your search criteria or <a href="/listings/new">create a new listing</a>.</p>
    </div>
  </div>
<% } %>
